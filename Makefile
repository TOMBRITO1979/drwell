.PHONY: help build up down logs restart clean migrate shell test

help:
	@echo "DrWell - Comandos Dispon√≠veis:"
	@echo "  make build     - Construir imagens Docker"
	@echo "  make up        - Iniciar todos os servi√ßos"
	@echo "  make down      - Parar todos os servi√ßos"
	@echo "  make logs      - Ver logs de todos os servi√ßos"
	@echo "  make restart   - Reiniciar todos os servi√ßos"
	@echo "  make clean     - Parar e remover volumes (CUIDADO!)"
	@echo "  make migrate   - Executar migrations do banco"
	@echo "  make shell     - Abrir shell no container da API"
	@echo "  make test      - Executar testes"

build:
	docker-compose build

up:
	docker-compose up -d
	@echo "‚úÖ Servi√ßos iniciados!"
	@echo "üìù API: http://localhost/api/v1"
	@echo "üìö Docs: http://localhost/docs"
	@echo "üå∏ Flower: http://localhost:5555"
	@echo "üîÄ Traefik: http://localhost:8080"

down:
	docker-compose down

logs:
	docker-compose logs -f

restart:
	docker-compose restart

clean:
	@echo "‚ö†Ô∏è  ATEN√á√ÉO: Isso ir√° apagar todos os dados!"
	@read -p "Tem certeza? [y/N] " -n 1 -r; \
	echo; \
	if [[ $$REPLY =~ ^[Yy]$$ ]]; then \
		docker-compose down -v; \
		echo "‚úÖ Volumes removidos"; \
	fi

migrate:
	docker-compose exec api alembic upgrade head

shell:
	docker-compose exec api bash

test:
	docker-compose exec api pytest
